\chapter{Legendre expansions of energy-angle probability densities
in the center-of-mass frame}
\label{Ch:Legendre-cm}

Energy-angle probability density data in \xendl\ may also be given
as Legendre coefficients for the expansion Eq.~(\ref{piLegendre})
with outgoing energy $E$ and direction cosine~$\mu$ in the center-of-mass 
frame.  In this case,
the data consists of tables of coefficients $\pi_\ell( \Ecm' \mid E)$
for the sum
\begin{equation}
  \pi( \Ecm', \mucm \mid E) = \sum_\ell
  \left(
    \ell + \frac{1}{2}
  \right)
  \pi_\ell( \Ecm' \mid E) P_\ell( \mucm )
 \label{pi-Legendre-cm}
\end{equation}
for a set of outgoing energies~$\Ecm'$ at incident energies~$E$.
The number of terms in the sum in Eq.~(\ref{pi-Legendre-cm})
is determined by the data.

The analysis given in this section is also applicable to the case
of isotropic energy probability densities given
in the center-of-mass frame.  The data then consist only of
values of the $\pi_0( \Ecm' \mid E)$ term in Eq.~(\ref{pi-Legendre-cm}).

For incident energies $E$ between the tabulated values,
the coefficients $\pi_\ell( \Ecm' \mid E)$ are obtained by one of
the interpolation methods discussed in Section~\ref{Sec:2d-interp}.

For the probability density $\pi( \Ecm', \mucm \mid E) $ in
Eq.~(\ref{pi-Legendre-cm}), the integral Eq.~(\ref{Inum})
for computing the number-preserving transfer matrix becomes
\begin{equation}
  \Inum_{gh,\ell} =
         \int_{\calE_g} dE \, \sigma ( E ) M(E) w(E) \widetilde \phi_\ell(E) 
       \, \int_{ \calD_{h, \text{cm} }} d \Ecm' \, d\mucm \,
             P_\ell( \mulab ) \pi( \Ecm', \mucm \mid E) ,
 \label{Inum-Legendre-cm}
\end{equation}
where $\calD_{h, \text{cm}}$ is the set of outgoing energies $\Ecm'$
and direction cosines $\mucm$ which are mapped into $\calE_h'$
under the boost to the laboratory frame for incident particles with energy~$E$.

Figure~\ref{Fig:boost-regions} illustrates the portion of the region $\calD_{h, \text{cm} }$
for one incident energy generated by a range of outgoing energies 
corresponding to the data
\begin{equation}
  E'_{\text{cm}, j-1} \le \Ecm' \le  E'_{\text{cm}, j}.
 \label{calDh-energy-range}
\end{equation}
In this figure the outgoing energy bin $\calE_h'$ in the laboratory frame
 is a half annulus
centered at the origin with radii corresponding to the upper and
lower boundaries of the energy bin.
The vector $\Vtrans$ is the velocity of the center of mass 
with magnitude $\vtrans$ as in Eq.~(\ref{Vtrans-length}).
The range of outgoing center-of-mass energies in Eq.~(\ref{calDh-energy-range})
produces the second half annulus in Figure~8-1, and its contribution to
the set $\calD_{h, \text{cm} }$
is the intersection of these two half annuli and is shaded dark gray.
This dark gray set displays the outgoing energies $\Ecm'$ in the center-of-mass frame
which satisfy Eq.~(\ref{calDh-energy-range}) and the direction cosines
$\mucm$ such that the energy $E$ of the outgoing particle in the laboratory
frame is in the bin~$\calE_h'$.  In this figure, the upper limit of $\calE_h'$ is
indicated by the arc $\Elab' = \Ebin'$.

\begin{figure}
\input{fig8-1}
\end{figure}

\section{Geometrical considerations}
\label{Sec:boost-geometry}
The first question in the analysis of the integral in Eq.~(\ref{Inum-Legendre-cm})
is the determination of the set~$\calD_{h, \text{cm} }$.  This requires
knowing whether or not the arc for a bin boundary $\Elab' = \Ebin'$ 
intersects an arc $\Ecm' = E'_{\text{cm},j}$ derived from a data point.  For a boost
to the laboratory frame using Newtonian mechanics as in Eq.~(\ref{E_lab}),
this identification is achieved by the function
\begin{equation}
  G_0( \Ebin',  \Ecm', E ) = 2 \Ebin'( \Etrans' + \Ecm' ) -
    ( \Etrans' - \Ecm' )^2 - {\Ebin'}^2.
  \label{def-G0}
\end{equation}
Note that in $G_0$ the dependence on the energy $E$ of the
incident particle typically enters in two ways.  For one thing, 
$\Etrans'$ depends on $E$ as
in Eq.~(\ref{E_trans}).  On the other hand, if the interpolation with
respect to incident energy is unit-base or by cumulative 
points, then the inversion of the unit-base map Eq.~(\ref{range-inv}) 
takes the form
\begin{equation}
  \Ecm' = E'_{\text{cm}, \text{min}} +
     ( E'_{\text{cm}, \text{max}} - E'_{\text{cm}, \text{min}} ) 
    \widehat \Ecm'.
 \label{Kalb-unit-base}
\end{equation}
In linear-linear unit-base interpolation, $\widehat \Ecm'$ is fixed in
the interval $0 \le \widehat \Ecm' \le 1$, while
$E'_{\text{cm}, \text{min}}$
and $E'_{\text{cm}, \text{max}}$ depend on $E$ according to
Eq.~(\ref{EoutRange}) with $q$ given by Eq.~(\ref{def-q}).

The utility of the function $G_0$ in Eq.~(\ref{Kalb-unit-base})
depends on the following result.

\subsection{Assertion}\label{Sec:assertion8}
\textit{In Figure~\ref{Fig:boost-regions} under a Newtonian boost at fixed incident energy $E$, 
an arc $\Elab' = \Ebin'$ representing an edge of an energy bin in
the laboratory frame intersects an arc
$\Ecm' = {\rm const}$ generated by data
in the center-of-mass frame  if and only if}
\begin{equation}
   G_0( \Ebin', \Ecm', E ) \ge 0.
  \label{G0-pos}
\end{equation}

This assertion is proved in Appendix~\ref{Sec:Appendix-B}.

One application of Assertion~\ref{Sec:assertion8} is that of finding the incident energies
$E$ in $\calE_g$ in the integral Eq.~(\ref{Inum-Legendre-cm}) such that
the set $\calD_{h, \text{cm} }$ is non-empty.  This may be done by
locating the zeros of $G_0( \Ebin',  \Ecm', E )$ as a function of $E$
with the edges of the bin $\calE_h'$ as values of $\Ebin'$ and with
$\Ecm'$ as in Eq.~(\ref{Kalb-unit-base}) for 
$$
  \widehat \Ecm' = \widehat E'_{\text{cm}, j-1}
  \quad \text{and} \quad
  \widehat \Ecm' = \widehat E'_{\text{cm}, j},
$$
according to the data.

\section{Input of Legendre coefficients of energy-angle probability
densities in the center-of-mass frame}
The format for input of the coefficients $\pi_\ell( \Ecm' \mid E)$
in Eq.~(\ref{pi-Legendre-cm}) is that of Section~\ref{Sec:ENDF-I4-data}
with some obvious modifications.  For one thing, the data are in
the center-of-mass frame\\
 \Input{Product Frame: CenterOfMass}{}
 
The other difference is that information on particle masses is
required by the boost to the laboratory frame\\
  \Input{Projectile's mass:}{$\myi$} \\
 \Input{Target's mass:}{$\mtarg$} \\
 \Input{Product's mass:}{$\myo$} \\
 \Input{Reaction's Q value:}{$Q$} \\
The values of these quantities must be in the same units as
the energy bin boundaries.

The code computes the mass of the residual from the $Q$ value and
the masses of the other particles.  If the input file also contains the line\\
 \Input{Residual's mass:}{$\mres$}\\
the code compares this value with the mass it computed, printing
a warning message if they are significantly different.

Currently, the boost for this type of data is only implemented using Newtonian mechanics.

\section{Input of isotropic energy probability
densities in the center-of-mass frame}
\label{Sec:isotropic-table-cm}

The format for isotropic energy probability
density data given in the center-of-mass frame is the
same as that for laboratory-frame data in
Section~\ref{Sec:isotropic-table-lab}, except that
the line\\
  \Input{Product Frame: lab}{}\\
is replaced by\\
 \Input{Product Frame: CenterOfMass}{}
